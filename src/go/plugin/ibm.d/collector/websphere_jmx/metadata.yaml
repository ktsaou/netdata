plugin_name: ibm.d.plugin
modules:
  - meta:
      id: collector-ibm.d-websphere_jmx
      module_name: websphere_jmx
      plugin_name: ibm.d.plugin
      monitored_instance:
        name: IBM WebSphere Application Server (JMX)
        link: https://www.ibm.com/products/websphere-application-server
        icon_filename: ibm.svg
        categories:
          - data-collection.application-servers
      keywords:
        - websphere
        - was
        - jmx
        - java
        - application server
        - ibm
      related_resources:
        integrations:
          list: []
      info_provided_to_referring_integrations:
        description: ""
      most_popular: false
    overview:
      data_collection:
        metrics_description: |
          This collector monitors IBM WebSphere Application Server via JMX.

          It collects metrics for:
          - JVM performance (heap, GC, threads, classes)
          - Thread pool utilization
          - JDBC connection pool statistics
          - JMS destination metrics
          - Web application performance
          - HTTP session statistics
          - JTA transaction metrics
        method_description: |
          The collector uses a persistent Java helper process to connect to WebSphere's JMX interface.
          This approach avoids JVM startup overhead and provides efficient metric collection.
      supported_platforms:
        include: []
        exclude: []
      multi_instance: true
      additional_permissions:
        description: |
          - JMX must be enabled on the WebSphere server
          - Network access to the JMX port (typically 9999 for RMI or 2809 for IIOP)
          - Valid credentials if security is enabled
      default_behavior:
        auto_detection:
          description: |
            The collector does not auto-detect WebSphere instances.
            You must manually configure the JMX connection URL.
        limits:
          description: |
            By default, the collector limits:
            - 50 thread pools
            - 50 JDBC pools
            - 50 JMS destinations
            - 100 applications
        performance_impact:
          description: |
            Low impact. The Java helper process maintains a persistent connection,
            avoiding repeated JVM startups. JMX queries are lightweight.
    setup:
      prerequisites:
        list:
          - title: Enable JMX on WebSphere
            description: |
              1. In the WebSphere admin console, navigate to:
                 Servers > Server Types > WebSphere application servers > [server_name] > Java and Process Management > Process definition > Java Virtual Machine
              2. Add the following generic JVM arguments:
                 ```
                 -Dcom.sun.management.jmxremote
                 -Dcom.sun.management.jmxremote.port=9999
                 -Dcom.sun.management.jmxremote.authenticate=false
                 -Dcom.sun.management.jmxremote.ssl=false
                 ```
              3. For production, enable authentication and SSL
              4. Restart the WebSphere server
          - title: Java Runtime
            description: |
              The collector requires Java 8 or later to be installed and available in PATH.
              For WebSphere Traditional, you may need to use WebSphere's Java installation.
          - title: WebSphere Client Libraries (Traditional WAS only)
            description: |
              For WebSphere Traditional using IIOP protocol, you need the WebSphere thin client libraries.
              Set the jmx_classpath configuration option to point to these libraries.
      configuration:
        file:
          name: ibm.d/websphere_jmx.conf
        options:
          description: |
            The following options can be defined globally: update_every.
          folding:
            title: Config options
            enabled: true
          list:
            - name: update_every
              description: Data collection frequency.
              default_value: 5
              required: false
            - name: jmx_url
              description: |
                JMX service URL. Examples:
                - RMI: service:jmx:rmi:///jndi/rmi://localhost:9999/jmxrmi
                - IIOP: service:jmx:iiop://localhost:2809/jndi/JMXConnector
              default_value: ""
              required: true
            - name: jmx_username
              description: Username for JMX authentication
              default_value: ""
              required: false
            - name: jmx_password
              description: Password for JMX authentication
              default_value: ""
              required: false
            - name: jmx_classpath
              description: |
                Additional classpath for WebSphere client libraries.
                Example: /opt/IBM/WebSphere/AppServer/runtimes/*
              default_value: ""
              required: false
            - name: java_exec_path
              description: Path to Java executable (defaults to 'java' in PATH)
              default_value: ""
              required: false
            - name: collect_jvm_metrics
              description: Collect JVM heap, GC, thread, and class loading metrics
              default_value: true
              required: false
            - name: collect_threadpool_metrics
              description: Collect WebSphere thread pool statistics
              default_value: true
              required: false
            - name: collect_jdbc_metrics
              description: Collect JDBC connection pool statistics
              default_value: true
              required: false
            - name: collect_jca_metrics
              description: Collect JCA (Java Connector Architecture) connection pool statistics
              default_value: true
              required: false
            - name: collect_jms_metrics
              description: Collect JMS destination statistics
              default_value: true
              required: false
            - name: collect_webapp_metrics
              description: Collect web application performance metrics
              default_value: true
              required: false
            - name: collect_session_metrics
              description: Collect HTTP session statistics
              default_value: true
              required: false
            - name: collect_transaction_metrics
              description: Collect JTA transaction statistics
              default_value: true
              required: false
            - name: max_threadpools
              description: Maximum number of thread pools to monitor (0 for unlimited)
              default_value: 50
              required: false
            - name: max_jdbc_pools
              description: Maximum number of JDBC pools to monitor (0 for unlimited)
              default_value: 50
              required: false
            - name: max_jca_pools
              description: Maximum number of JCA pools to monitor (0 for unlimited)
              default_value: 50
              required: false
            - name: max_jms_destinations
              description: Maximum number of JMS destinations to monitor (0 for unlimited)
              default_value: 50
              required: false
            - name: max_applications
              description: Maximum number of applications to monitor (0 for unlimited)
              default_value: 100
              required: false
            - name: collect_apps_matching
              description: Only collect metrics for applications matching this pattern
              default_value: ""
              required: false
            - name: collect_pools_matching
              description: Only collect metrics for pools matching this pattern
              default_value: ""
              required: false
            - name: collect_jms_matching
              description: Only collect metrics for JMS destinations matching this pattern
              default_value: ""
              required: false
        examples:
          folding:
            title: Config
            enabled: true
          list:
            - name: Basic RMI connection
              description: Monitor local WebSphere with RMI protocol.
              config: |
                jobs:
                  - name: local
                    jmx_url: service:jmx:rmi:///jndi/rmi://localhost:9999/jmxrmi
            - name: Authenticated IIOP connection
              description: Monitor remote WebSphere Traditional with authentication.
              config: |
                jobs:
                  - name: production
                    jmx_url: service:jmx:iiop://washost.example.com:2809/jndi/JMXConnector
                    jmx_username: wasadmin
                    jmx_password: mypassword
                    jmx_classpath: /opt/IBM/WebSphere/AppServer/runtimes/*
            - name: Limited collection
              description: Only collect essential metrics with cardinality limits.
              config: |
                jobs:
                  - name: limited
                    jmx_url: service:jmx:rmi:///jndi/rmi://localhost:9999/jmxrmi
                    collect_jvm_metrics: true
                    collect_threadpool_metrics: false
                    collect_jdbc_metrics: true
                    collect_jms_metrics: false
                    collect_webapp_metrics: true
                    collect_session_metrics: false
                    collect_transaction_metrics: false
                    max_jdbc_pools: 10
                    max_applications: 20
            - name: Filtered monitoring
              description: Monitor specific applications and pools.
              config: |
                jobs:
                  - name: filtered
                    jmx_url: service:jmx:rmi:///jndi/rmi://localhost:9999/jmxrmi
                    collect_apps_matching: "prod_*"
                    collect_pools_matching: "*oracle*"
                    collect_jms_matching: "Queue_*"
    troubleshooting:
      problems:
        list:
          - name: JMX connection fails
            description: |
              Check that:
              1. JMX is enabled on the WebSphere server
              2. The JMX URL is correct
              3. Firewall allows access to the JMX port
              4. Authentication credentials are correct (if required)
          - name: Missing metrics for some resources
            description: |
              This can happen if:
              1. Cardinality limits are reached (check max_* settings)
              2. Resource names don't match the configured patterns
              3. The WebSphere user lacks permissions to access certain MBeans
          - name: Java helper process fails to start
            description: |
              Ensure that:
              1. Java is installed and in PATH
              2. The websphere_jmx_helper.jar file exists
              3. For WebSphere Traditional, the jmx_classpath points to valid libraries
    alerts:
      - name: websphere_jmx_jvm_heap_usage
        metric: websphere_jmx.jvm_heap_usage
        info: JVM heap memory usage
        link: https://github.com/netdata/netdata/blob/master/src/health/health.d/websphere_jmx.conf
    metrics:
      folding:
        title: Metrics
        enabled: false
      description: ""
      availability: []
      scopes:
        - name: global
          description: These metrics refer to the entire WebSphere instance.
          labels: []
          metrics:
            - name: websphere_jmx.jvm_heap_memory
              description: JVM Heap Memory
              unit: bytes
              chart_type: stacked
              dimensions:
                - name: used
                - name: committed
                - name: max
            - name: websphere_jmx.jvm_heap_usage
              description: JVM Heap Usage
              unit: percentage
              chart_type: line
              dimensions:
                - name: usage
            - name: websphere_jmx.jvm_nonheap_memory
              description: JVM Non-Heap Memory
              unit: bytes
              chart_type: stacked
              dimensions:
                - name: used
                - name: committed
            - name: websphere_jmx.jvm_gc_count
              description: JVM Garbage Collection Count
              unit: collections
              chart_type: line
              dimensions:
                - name: collections
            - name: websphere_jmx.jvm_gc_time
              description: JVM Garbage Collection Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: time
            - name: websphere_jmx.jvm_threads
              description: JVM Threads
              unit: threads
              chart_type: stacked
              dimensions:
                - name: total
                - name: daemon
            - name: websphere_jmx.jvm_thread_states
              description: JVM Thread States
              unit: threads
              chart_type: line
              dimensions:
                - name: peak
                - name: started
            - name: websphere_jmx.jvm_classes
              description: JVM Classes
              unit: classes
              chart_type: line
              dimensions:
                - name: loaded
                - name: unloaded
            - name: websphere_jmx.jvm_process_cpu_usage
              description: JVM Process CPU Usage
              unit: percentage
              chart_type: line
              dimensions:
                - name: cpu
            - name: websphere_jmx.jvm_uptime
              description: JVM Uptime
              unit: seconds
              chart_type: line
              dimensions:
                - name: uptime
        - name: thread pool
          description: These metrics refer to a specific thread pool.
          labels:
            - name: thread_pool
              description: Thread pool name
          metrics:
            - name: websphere_jmx.threadpool_size
              description: Thread Pool Size
              unit: threads
              chart_type: line
              dimensions:
                - name: size
                - name: max
            - name: websphere_jmx.threadpool_active
              description: Thread Pool Active Threads
              unit: threads
              chart_type: line
              dimensions:
                - name: active
        - name: jdbc pool
          description: These metrics refer to a specific JDBC connection pool.
          labels:
            - name: jdbc_pool
              description: JDBC pool name
          metrics:
            - name: websphere_jmx.jdbc_pool_size
              description: JDBC Pool Size
              unit: connections
              chart_type: line
              dimensions:
                - name: size
            - name: websphere_jmx.jdbc_pool_active
              description: JDBC Pool Active Connections
              unit: connections
              chart_type: stacked
              dimensions:
                - name: active
                - name: free
            - name: websphere_jmx.jdbc_pool_wait_time
              description: JDBC Pool Average Wait Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: wait_time
            - name: websphere_jmx.jdbc_pool_use_time
              description: JDBC Pool Average Use Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: use_time
            - name: websphere_jmx.jdbc_pool_connections
              description: JDBC Pool Connections Created/Destroyed
              unit: connections
              chart_type: line
              dimensions:
                - name: created
                - name: destroyed
            - name: websphere_jmx.jdbc_pool_waiting_threads
              description: JDBC Pool Waiting Threads
              unit: threads
              chart_type: line
              dimensions:
                - name: waiting
        - name: jca pool
          description: These metrics refer to a specific JCA (Java Connector Architecture) connection pool.
          labels:
            - name: jca_pool
              description: JCA pool name
          metrics:
            - name: websphere_jmx.jca_pool_size
              description: JCA Pool Size
              unit: connections
              chart_type: line
              dimensions:
                - name: size
            - name: websphere_jmx.jca_pool_active
              description: JCA Pool Active Connections
              unit: connections
              chart_type: stacked
              dimensions:
                - name: active
                - name: free
            - name: websphere_jmx.jca_pool_wait_time
              description: JCA Pool Average Wait Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: wait_time
            - name: websphere_jmx.jca_pool_use_time
              description: JCA Pool Average Use Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: use_time
            - name: websphere_jmx.jca_pool_connections
              description: JCA Pool Connections Created/Destroyed
              unit: connections
              chart_type: line
              dimensions:
                - name: created
                - name: destroyed
            - name: websphere_jmx.jca_pool_waiting_threads
              description: JCA Pool Waiting Threads
              unit: threads
              chart_type: line
              dimensions:
                - name: waiting
        - name: jms destination
          description: These metrics refer to a specific JMS queue or topic.
          labels:
            - name: jms_destination
              description: JMS destination name
            - name: jms_type
              description: JMS destination type (queue or topic)
          metrics:
            - name: websphere_jmx.jms_messages
              description: JMS Messages
              unit: messages
              chart_type: stacked
              dimensions:
                - name: current
                - name: pending
            - name: websphere_jmx.jms_messages_total
              description: JMS Total Messages
              unit: messages
              chart_type: line
              dimensions:
                - name: total
            - name: websphere_jmx.jms_consumers
              description: JMS Consumers
              unit: consumers
              chart_type: line
              dimensions:
                - name: consumers
        - name: application
          description: These metrics refer to a specific web application.
          labels:
            - name: application
              description: Application name
          metrics:
            - name: websphere_jmx.app_requests
              description: Application Requests
              unit: requests
              chart_type: line
              dimensions:
                - name: requests
            - name: websphere_jmx.app_errors
              description: Application Errors
              unit: errors
              chart_type: line
              dimensions:
                - name: errors
            - name: websphere_jmx.app_response_time
              description: Application Response Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: avg
                - name: max
            - name: websphere_jmx.app_sessions
              description: Application Sessions
              unit: sessions
              chart_type: stacked
              dimensions:
                - name: active
                - name: live
            - name: websphere_jmx.app_sessions_invalidated
              description: Application Sessions Invalidated
              unit: sessions
              chart_type: line
              dimensions:
                - name: invalidated
            - name: websphere_jmx.app_transactions_active
              description: Application Active Transactions
              unit: transactions
              chart_type: line
              dimensions:
                - name: active
            - name: websphere_jmx.app_transactions_total
              description: Application Transaction Outcomes
              unit: transactions
              chart_type: stacked
              dimensions:
                - name: committed
                - name: rolledback
                - name: timeout
        - name: cluster
          description: These metrics refer to WebSphere cluster state and health (deployment manager only).
          labels:
            - name: cluster
              description: Cluster name
            - name: cell
              description: Cell name
            - name: node
              description: Node name
            - name: server_type
              description: Server type (app_server, dmgr, nodeagent)
          metrics:
            - name: websphere_jmx.cluster_state
              description: Cluster State
              unit: state
              chart_type: line
              dimensions:
                - name: state
                  description: "0=stopped, 1=partial, 2=running"
            - name: websphere_jmx.cluster_members
              description: Cluster Members
              unit: members
              chart_type: line
              dimensions:
                - name: running
                - name: target
            - name: websphere_jmx.cluster_workload
              description: Cluster Workload Management
              unit: status
              chart_type: line
              dimensions:
                - name: wlm_enabled
                - name: session_affinity
            - name: websphere_jmx.ha_manager
              description: High Availability Manager
              unit: status
              chart_type: line
              dimensions:
                - name: is_coordinator
                - name: core_group_size
            - name: websphere_jmx.ha_bulletins
              description: HA Manager Bulletins
              unit: bulletins
              chart_type: line
              dimensions:
                - name: sent
            - name: websphere_jmx.dynamic_cluster_instances
              description: Dynamic Cluster Instances
              unit: instances
              chart_type: line
              dimensions:
                - name: min
                - name: max
                - name: target
            - name: websphere_jmx.replication_traffic
              description: Replication Traffic
              unit: bytes/s
              chart_type: line
              dimensions:
                - name: sent
                - name: received
            - name: websphere_jmx.replication_health
              description: Replication Health
              unit: operations
              chart_type: line
              dimensions:
                - name: sync_failures
                - name: async_queue_depth
        - name: connection
          description: These metrics refer to JMX connection health and resilience.
          labels: []
          metrics:
            - name: websphere_jmx.connection_health
              description: Connection Health Status
              unit: status
              chart_type: line
              dimensions:
                - name: health
                  description: "0=down, 1=up"
                - name: circuit_breaker
                  description: "0=closed, 1=half-open, 2=open"
            - name: websphere_jmx.connection_staleness
              description: Connection Staleness
              unit: seconds
              chart_type: line
              dimensions:
                - name: age
                  description: "Seconds since last successful collection"
