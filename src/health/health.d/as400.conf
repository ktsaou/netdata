# IBM AS/400 (IBM i) health alerts

# CPU utilization
template: as400_cpu_utilization
      on: as400.cpu_utilization
   class: Utilization
    type: Database
component: AS/400
  lookup: average -1m unaligned of utilization
   units: %
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (75) : (80))
    crit: $this > (($status == $CRITICAL) ? (85) : (90))
   delay: down 15m multiplier 1.5 max 1h
 summary: AS/400 CPU utilization
    info: CPU utilization is ${value}% on AS/400 system
      to: dba

# System ASP (disk) usage
template: as400_system_asp_usage
      on: as400.system_asp_usage
   class: Utilization
    type: Database
component: AS/400
  lookup: average -1m unaligned of used
   units: %
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (75) : (80))
    crit: $this > (($status == $CRITICAL) ? (85) : (90))
   delay: down 15m multiplier 1.5 max 1h
 summary: AS/400 system ASP usage
    info: System ASP (auxiliary storage pool) usage is ${value}% on AS/400 system
      to: dba

# Average disk busy percentage
template: as400_disk_busy_percentage
      on: as400.disk_busy
   class: Utilization
    type: Database
component: AS/400
  lookup: average -5m unaligned of busy
   units: %
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (65) : (70))
    crit: $this > (($status == $CRITICAL) ? (75) : (80))
   delay: down 15m multiplier 1.5 max 1h
 summary: AS/400 average disk busy
    info: Average disk busy percentage is ${value}% on AS/400 system
      to: dba

# Job queue length (aggregate)
template: as400_job_queue_length
      on: as400.job_queue_length
   class: Workload
    type: Database
component: AS/400
  lookup: average -5m unaligned of queued
   units: jobs
   every: 30s
    warn: $this > (($status >= $WARNING)  ? (90) : (100))
    crit: $this > (($status == $CRITICAL) ? (190) : (200))
   delay: down 5m multiplier 1.5 max 1h
 summary: AS/400 job queue length
    info: Job queue length is ${value} jobs on AS/400 system
      to: dba

# Memory pool critical usage
template: as400_memory_pool_usage_machine
      on: as400.memory_pool_usage
   class: Utilization
    type: Database
component: AS/400
    calc: $machine * 100 / ($machine + $base + $interactive + $spool)
   units: %
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (85) : (90))
    crit: $this > (($status == $CRITICAL) ? (92) : (95))
   delay: down 15m multiplier 1.5 max 1h
 summary: AS/400 machine pool usage
    info: Machine memory pool is using ${value}% of total memory on AS/400 system
      to: dba

# Per-disk response time (if disk metrics are enabled)
template: as400_disk_response_time
      on: as400.disk_avg_time
   class: Latency
    type: Database
component: AS/400
  lookup: average -5m unaligned of response_time
   units: ms
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (45) : (50))
    crit: $this > (($status == $CRITICAL) ? (95) : (100))
   delay: down 15m multiplier 1.5 max 1h
 summary: AS/400 disk ${label:disk_unit} response time
    info: Disk ${label:disk_unit} average response time is ${value}ms on AS/400 system
      to: dba

# Per-subsystem held jobs (if subsystem metrics are enabled)
template: as400_subsystem_jobs_held
      on: as400.subsystem_jobs
   class: Workload
    type: Database
component: AS/400
    calc: $held * 100 / ($active + $held)
   units: %
   every: 30s
    warn: $this > (($status >= $WARNING)  ? (15) : (20))
    crit: $this > (($status == $CRITICAL) ? (25) : (30))
   delay: down 5m multiplier 1.5 max 1h
 summary: AS/400 subsystem ${label:subsystem} held jobs
    info: Subsystem ${label:subsystem} has ${value}% of jobs in held state on AS/400 system
      to: dba

# Per-job queue backlog (if job queue metrics are enabled)
template: as400_job_queue_backlog
      on: as400.jobqueue_length
   class: Workload
    type: Database
component: AS/400
  lookup: sum -5m unaligned of waiting
   units: jobs
   every: 30s
    warn: $this > (($status >= $WARNING)  ? (45) : (50))
    crit: $this > (($status == $CRITICAL) ? (95) : (100))
   delay: down 5m multiplier 1.5 max 1h
 summary: AS/400 job queue ${label:job_queue} backlog
    info: Job queue ${label:job_queue} has ${value} waiting jobs on AS/400 system
      to: dba