# IBM DB2 health alerts

# Connection usage
template: db2_connection_usage
      on: db2.connections
   class: Utilization
    type: Database
component: DB2
    calc: $active * 100 / $total
   units: %
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (80) : (85))
    crit: $this > (($status == $CRITICAL) ? (90) : (95))
   delay: down 5m multiplier 1.5 max 1h
 summary: DB2 connection usage
    info: Active connections are at ${value}% of maximum on DB2 database
      to: dba

# Lock timeouts
template: db2_lock_timeout_rate
      on: db2.locking
   class: Errors
    type: Database
component: DB2
  lookup: sum -1m unaligned of timeouts
   units: timeouts
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (5) : (10))
    crit: $this > (($status == $CRITICAL) ? (20) : (30))
   delay: down 5m multiplier 1.5 max 1h
 summary: DB2 lock timeouts
    info: Lock timeouts in the last minute on DB2 database
      to: dba

# Deadlocks
template: db2_deadlock_rate
      on: db2.deadlocks
   class: Errors
    type: Database
component: DB2
  lookup: sum -1m unaligned of deadlocks
   units: deadlocks
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (0) : (1))
    crit: $this > (($status == $CRITICAL) ? (2) : (5))
   delay: down 5m multiplier 1.5 max 1h
 summary: DB2 deadlocks
    info: Deadlocks detected in the last minute on DB2 database
      to: dba

# Buffer pool hit ratio
template: db2_bufferpool_hit_ratio_low
      on: db2.bufferpool_hit_ratio
   class: Performance
    type: Database
component: DB2
  lookup: average -5m unaligned of hit_ratio
   units: %
   every: 10s
    warn: $this < (($status >= $WARNING)  ? (85) : (80))
    crit: $this < (($status == $CRITICAL) ? (75) : (70))
   delay: down 15m multiplier 1.5 max 1h
 summary: DB2 buffer pool hit ratio
    info: Buffer pool hit ratio is ${value}% on DB2 database (poor performance)
      to: dba

# Sort overflows
template: db2_sort_overflow_ratio
      on: db2.sorting
   class: Performance
    type: Database
component: DB2
    calc: $overflows * 100 / ($sorts + $overflows)
   units: %
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (3) : (5))
    crit: $this > (($status == $CRITICAL) ? (8) : (10))
   delay: down 15m multiplier 1.5 max 1h
 summary: DB2 sort overflows
    info: Sort overflow ratio is ${value}% on DB2 database
      to: dba

# Log space usage
template: db2_log_space_usage
      on: db2.log_space
   class: Utilization
    type: Database
component: DB2
    calc: $used * 100 / ($used + $available)
   units: %
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (70) : (75))
    crit: $this > (($status == $CRITICAL) ? (85) : (90))
   delay: down 5m multiplier 1.5 max 1h
 summary: DB2 log space usage
    info: Log space usage is ${value}% on DB2 database
      to: dba

# Per-tablespace usage (if tablespace metrics are enabled)
template: db2_tablespace_usage
      on: db2.tablespace_usage
   class: Utilization
    type: Database
component: DB2
  lookup: average -1m unaligned of used
   units: %
   every: 10s
    warn: $this > (($status >= $WARNING)  ? (80) : (85))
    crit: $this > (($status == $CRITICAL) ? (90) : (95))
   delay: down 15m multiplier 1.5 max 1h
 summary: DB2 tablespace ${label:tablespace} usage
    info: Tablespace ${label:tablespace} usage is ${value}% on DB2 database
      to: dba

# Per-bufferpool hit ratio (if bufferpool metrics are enabled)
template: db2_bufferpool_instance_hit_ratio
      on: db2.bufferpool_hit_ratio
   class: Performance
    type: Database
component: DB2
  lookup: average -5m unaligned of hit_ratio
   units: %
   every: 10s
    warn: $this < (($status >= $WARNING)  ? (85) : (80))
    crit: $this < (($status == $CRITICAL) ? (75) : (70))
   delay: down 15m multiplier 1.5 max 1h
 summary: DB2 buffer pool ${label:bufferpool} hit ratio
    info: Buffer pool ${label:bufferpool} hit ratio is ${value}% on DB2 database
      to: dba