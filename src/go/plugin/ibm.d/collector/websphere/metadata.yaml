plugin_name: ibm.d.plugin
modules:
  - meta:
      plugin_name: ibm.d.plugin
      module_name: websphere
      monitored_instance:
        name: IBM WebSphere Application Server
        link: https://www.ibm.com/products/websphere-application-server
        categories:
          - data-collection.apm
        icon_filename: "websphere.svg"
      alternative_monitored_instances: []
      related_resources:
        integrations:
          list: []
      info_provided_to_referring_integrations:
        description: ""
      keywords:
        - websphere
        - was
        - liberty
        - java
        - jvm
        - application server
      most_popular: false
    overview:
      data_collection:
        metrics_description: |
          This collector monitors IBM WebSphere Application Server instances, including both WebSphere Liberty
          and traditional WebSphere Application Server. It collects metrics about JVM performance, thread pools,
          connection pools, web applications, and HTTP sessions.
        method_description: |
          The collector uses WebSphere's REST API (Liberty) or JMX interface (Traditional) to gather metrics.
          For Liberty servers, it queries the `/ibm/api/metrics` endpoint which provides comprehensive
          performance data in JSON format.
      supported_platforms:
        include: []
        exclude: []
      multi_instance: true
      additional_permissions:
        description: ""
      default_behavior:
        auto_detection:
          description: |
            The collector does not auto-detect WebSphere instances. Manual configuration is required.
        limits:
          description: |
            The collector limits the number of monitored instances to prevent high cardinality:
            - Thread pools: 20 (configurable)
            - Connection pools: 20 (configurable)
            - Applications: 50 (configurable)
        performance_impact:
          description: |
            The collector makes HTTP requests to the WebSphere metrics API. Impact depends on the number
            of monitored instances and the collection frequency.
    setup:
      prerequisites:
        list:
          - title: Enable WebSphere metrics
            description: |
              For Liberty servers, ensure the monitor-1.0 feature is enabled in server.xml:
              ```xml
              <featureManager>
                  <feature>monitor-1.0</feature>
              </featureManager>
              ```
          - title: Create monitoring user
            description: |
              Create a user with appropriate permissions to access metrics:
              - Liberty: User must have administrator or reader role
              - Traditional WAS: User must have monitor role
          - title: IBM DB2 libraries (for ibm.d.plugin)
            description: |
              Since this collector is part of ibm.d.plugin, IBM DB2 client libraries must be installed
              and LD_LIBRARY_PATH must be configured.
      configuration:
        file:
          name: ibm.d/websphere.conf
        options:
          description: |
            The following options can be defined globally, or per job in the `jobs` section.
          folding:
            title: Config options
            enabled: true
          list:
            - name: update_every
              description: Data collection frequency.
              default_value: 5
              required: false
            - name: url
              description: WebSphere server URL.
              default_value: https://localhost:9443
              required: true
            - name: timeout
              description: HTTP request timeout.
              default_value: 5
              required: false
            - name: username
              description: Username for basic authentication.
              default_value: ""
              required: false
            - name: password
              description: Password for basic authentication.
              default_value: ""
              required: false
            - name: metrics_endpoint
              description: Liberty metrics API endpoint path.
              default_value: /ibm/api/metrics
              required: false
            - name: collect_jvm_metrics
              description: Enable JVM metrics collection.
              default_value: true
              required: false
            - name: collect_threadpool_metrics
              description: Enable thread pool metrics collection.
              default_value: true
              required: false
            - name: collect_connectionpool_metrics
              description: Enable connection pool metrics collection.
              default_value: true
              required: false
            - name: collect_webapp_metrics
              description: Enable web application metrics collection.
              default_value: true
              required: false
            - name: collect_session_metrics
              description: Enable HTTP session metrics collection.
              default_value: true
              required: false
            - name: max_threadpools
              description: Maximum number of thread pools to monitor.
              default_value: 20
              required: false
            - name: max_connectionpools
              description: Maximum number of connection pools to monitor.
              default_value: 20
              required: false
            - name: max_applications
              description: Maximum number of applications to monitor.
              default_value: 50
              required: false
            - name: collect_apps_matching
              description: Filter applications by name (substring match).
              default_value: ""
              required: false
            - name: collect_pools_matching
              description: Filter pools by name (substring match).
              default_value: ""
              required: false
            - name: tls_skip_verify
              description: Skip TLS certificate verification.
              default_value: false
              required: false
            - name: tls_ca
              description: Path to CA certificate file.
              default_value: ""
              required: false
            - name: tls_cert
              description: Path to client certificate file.
              default_value: ""
              required: false
            - name: tls_key
              description: Path to client key file.
              default_value: ""
              required: false
        examples:
          folding:
            enabled: true
            title: Config
          list:
            - name: Basic Liberty server
              description: Monitor a WebSphere Liberty server with basic authentication.
              config: |
                jobs:
                  - name: liberty_local
                    url: https://localhost:9443
                    username: admin
                    password: adminpwd
            - name: Multiple servers
              description: Monitor multiple WebSphere servers.
              config: |
                jobs:
                  - name: liberty_prod
                    url: https://prod.example.com:9443
                    username: monitor
                    password: secret

                  - name: liberty_test
                    url: https://test.example.com:9443
                    username: monitor
                    password: secret
                    update_every: 10
            - name: With TLS client certificate
              description: Connect using TLS client certificate authentication.
              config: |
                jobs:
                  - name: liberty_secure
                    url: https://secure.example.com:9443
                    tls_cert: /path/to/client.crt
                    tls_key: /path/to/client.key
                    tls_ca: /path/to/ca.crt
            - name: Filter applications
              description: Monitor only specific applications.
              config: |
                jobs:
                  - name: liberty_apps
                    url: https://localhost:9443
                    username: admin
                    password: adminpwd
                    collect_apps_matching: myapp
                    max_applications: 10
            - name: Minimal collection
              description: Collect only JVM metrics.
              config: |
                jobs:
                  - name: liberty_minimal
                    url: https://localhost:9443
                    username: admin
                    password: adminpwd
                    collect_threadpool_metrics: false
                    collect_connectionpool_metrics: false
                    collect_webapp_metrics: false
                    collect_session_metrics: false
      troubleshooting:
        problems:
          list:
            - name: Connection refused
              description: |
                Unable to connect to WebSphere server.
              resolution: |
                1. Verify the URL and port are correct
                2. Check if WebSphere is running
                3. Ensure monitor-1.0 feature is enabled (Liberty)
                4. Check firewall rules
            - name: 401 Unauthorized
              description: |
                Authentication failed.
              resolution: |
                1. Verify username and password
                2. Ensure user has appropriate role (administrator/reader for Liberty)
                3. Check WebSphere security configuration
            - name: 404 Not Found
              description: |
                Metrics endpoint not found.
              resolution: |
                1. Verify metrics_endpoint path
                2. Ensure monitor-1.0 feature is enabled (Liberty)
                3. Check WebSphere version compatibility
            - name: Certificate errors
              description: |
                TLS certificate verification failed.
              resolution: |
                1. Use tls_skip_verify: true for testing (not recommended for production)
                2. Provide proper CA certificate with tls_ca option
                3. Ensure certificate is valid and not expired
    alerts: []
    metrics:
      folding:
        title: Metrics
        enabled: false
      description: |
        The collector provides metrics for JVM, thread pools, connection pools, web applications, and sessions.
      availability: []
      scopes:
        - name: global
          description: These metrics refer to the entire WebSphere server instance.
          labels: []
          metrics:
            - name: websphere.jvm_heap_usage
              description: JVM Heap Usage
              unit: bytes
              chart_type: stacked
              dimensions:
                - name: used
                - name: committed
                - name: max
            - name: websphere.jvm_gc_time
              description: JVM Garbage Collection Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: gc_time
            - name: websphere.jvm_gc_count
              description: JVM Garbage Collection Count
              unit: collections/s
              chart_type: line
              dimensions:
                - name: collections
            - name: websphere.jvm_threads
              description: JVM Threads
              unit: threads
              chart_type: line
              dimensions:
                - name: threads
                - name: daemon
                - name: peak
            - name: websphere.jvm_classes
              description: JVM Loaded Classes
              unit: classes
              chart_type: line
              dimensions:
                - name: loaded
                - name: unloaded
            - name: websphere.web_sessions
              description: Web Sessions
              unit: sessions
              chart_type: line
              dimensions:
                - name: active
                - name: live
                - name: invalidated
            - name: websphere.web_requests
              description: Web Requests
              unit: requests/s
              chart_type: line
              dimensions:
                - name: requests
        - name: thread_pool
          description: These metrics refer to a specific thread pool.
          labels:
            - name: thread_pool
              description: Thread pool name
          metrics:
            - name: websphere.threadpool_size
              description: Thread Pool Size
              unit: threads
              chart_type: line
              dimensions:
                - name: size
                - name: max
            - name: websphere.threadpool_active
              description: Thread Pool Active Threads
              unit: threads
              chart_type: line
              dimensions:
                - name: active
            - name: websphere.threadpool_hung
              description: Thread Pool Hung Threads
              unit: threads
              chart_type: line
              dimensions:
                - name: hung
        - name: connection_pool
          description: These metrics refer to a specific connection pool.
          labels:
            - name: connection_pool
              description: Connection pool name
          metrics:
            - name: websphere.connpool_size
              description: Connection Pool Size
              unit: connections
              chart_type: line
              dimensions:
                - name: size
                - name: free
                - name: max
            - name: websphere.connpool_wait_time
              description: Connection Pool Wait Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: avg_wait
            - name: websphere.connpool_timeouts
              description: Connection Pool Timeouts
              unit: timeouts/s
              chart_type: line
              dimensions:
                - name: timeouts
        - name: application
          description: These metrics refer to a specific web application.
          labels:
            - name: application
              description: Application name
          metrics:
            - name: websphere.app_requests
              description: Application Requests
              unit: requests/s
              chart_type: line
              dimensions:
                - name: requests
            - name: websphere.app_response_time
              description: Application Response Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: avg_response
            - name: websphere.app_errors
              description: Application Errors
              unit: errors/s
              chart_type: line
              dimensions:
                - name: errors
