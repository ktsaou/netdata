plugin_name: ibm.d.plugin
modules:
  - meta:
      plugin_name: ibm.d.plugin
      module_name: websphere_mp
      monitored_instance:
        name: IBM WebSphere Liberty MicroProfile Metrics
        link: https://www.ibm.com/docs/en/was-liberty/core?topic=liberty-microprofile-metrics
        categories:
          - data-collection.apm
        icon_filename: "websphere.svg"
      alternative_monitored_instances: []
      related_resources:
        integrations:
          list: []
      info_provided_to_referring_integrations:
        description: ""
      keywords:
        - websphere
        - liberty
        - microprofile
        - metrics
        - prometheus
        - java
        - jvm
        - application server
      most_popular: false
    overview:
      data_collection:
        metrics_description: |
          This collector monitors IBM WebSphere Liberty servers with MicroProfile Metrics enabled.
          It collects comprehensive metrics including JVM performance, CPU usage, thread pool status,
          servlet performance, and session management.
        method_description: |
          The collector uses MicroProfile Metrics API to gather metrics in Prometheus format
          from the `/metrics` endpoint. This provides detailed performance data including
          JVM statistics, CPU utilization, thread pool usage, and servlet/session metrics.
      supported_platforms:
        include: []
        exclude: []
      multi_instance: true
      additional_permissions:
        description: ""
      default_behavior:
        auto_detection:
          description: |
            The collector does not auto-detect WebSphere Liberty instances. Manual configuration is required.
        limits:
          description: |
            The collector provides comprehensive monitoring of JVM and application server metrics
            with minimal performance impact.
        performance_impact:
          description: |
            The collector makes HTTP requests to the MicroProfile Metrics endpoint. Impact depends on
            the collection frequency. The collector efficiently processes standard JVM and server metrics.
    setup:
      prerequisites:
        list:
          - title: Enable MicroProfile Metrics
            description: |
              Ensure MicroProfile Metrics is enabled in your Liberty server.xml:
              ```xml
              <featureManager>
                  <feature>mpMetrics-4.0</feature>
              </featureManager>
              ```
          - title: Configure metrics endpoint access
            description: |
              Ensure the /metrics endpoint is accessible and properly secured:
              ```xml
              <mpMetrics authentication="false" />
              ```
              Or configure authentication for the monitoring user.
          - title: Create monitoring user
            description: |
              Create a user with appropriate permissions to access metrics:
              - Reader role is sufficient for metrics access
              - Administrator role provides full access
          - title: IBM DB2 libraries (for ibm.d.plugin)
            description: |
              Since this collector is part of ibm.d.plugin, IBM DB2 client libraries must be installed
              and LD_LIBRARY_PATH must be configured.
      configuration:
        file:
          name: ibm.d/websphere_mp.conf
        options:
          description: |
            The following options can be defined globally, or per job in the `jobs` section.
          folding:
            title: Config options
            enabled: true
          list:
            - name: update_every
              description: Data collection frequency.
              default_value: 5
              required: false
            - name: url
              description: WebSphere Liberty server URL.
              default_value: https://localhost:9443
              required: true
            - name: timeout
              description: HTTP request timeout.
              default_value: 10
              required: false
            - name: username
              description: Username for basic authentication.
              default_value: ""
              required: false
            - name: password
              description: Password for basic authentication.
              default_value: ""
              required: false
            - name: metrics_endpoint
              description: MicroProfile Metrics endpoint path.
              default_value: /metrics
              required: false
            - name: collect_jvm_metrics
              description: Enable JVM metrics collection.
              default_value: true
              required: false
            - name: tls_skip_verify
              description: Skip TLS certificate verification.
              default_value: false
              required: false
            - name: tls_ca
              description: Path to CA certificate file.
              default_value: ""
              required: false
            - name: tls_cert
              description: Path to client certificate file.
              default_value: ""
              required: false
            - name: tls_key
              description: Path to client key file.
              default_value: ""
              required: false
        examples:
          folding:
            enabled: true
            title: Config
          list:
            - name: Basic MicroProfile server
              description: Monitor a WebSphere Liberty server with MicroProfile Metrics.
              config: |
                jobs:
                  - name: liberty_mp_local
                    url: https://localhost:9443
                    username: admin
                    password: adminpwd
            - name: Multiple servers
              description: Monitor multiple Liberty servers.
              config: |
                jobs:
                  - name: liberty_mp_prod
                    url: https://prod.example.com:9443
                    username: monitor
                    password: secret

                  - name: liberty_mp_test
                    url: https://test.example.com:9443
                    username: monitor
                    password: secret
            - name: With TLS client certificate
              description: Connect using TLS client certificate authentication.
              config: |
                jobs:
                  - name: liberty_mp_secure
                    url: https://secure.example.com:9443
                    tls_cert: /path/to/client.crt
                    tls_key: /path/to/client.key
                    tls_ca: /path/to/ca.crt
            - name: Minimal JVM monitoring
              description: Collect only JVM metrics.
              config: |
                jobs:
                  - name: liberty_mp_minimal
                    url: https://localhost:9443
                    username: admin
                    password: adminpwd
                    collect_jvm_metrics: true
      troubleshooting:
        problems:
          list:
            - name: Connection refused
              description: |
                Unable to connect to WebSphere Liberty server.
              resolution: |
                1. Verify the URL and port are correct
                2. Check if Liberty is running
                3. Ensure MicroProfile Metrics feature is enabled
                4. Check firewall rules
            - name: 401 Unauthorized
              description: |
                Authentication failed when accessing metrics endpoint.
              resolution: |
                1. Verify username and password
                2. Ensure user has reader or administrator role
                3. Check if metrics endpoint requires authentication
                4. Verify mpMetrics configuration in server.xml
            - name: 404 Not Found
              description: |
                MicroProfile Metrics endpoint not found.
              resolution: |
                1. Verify metrics_endpoint path (default: /metrics)
                2. Ensure mpMetrics feature is enabled in server.xml
                3. Check Liberty version supports MicroProfile Metrics
    alerts: []
    metrics:
      folding:
        title: Metrics
        enabled: false
      description: |
        The collector provides comprehensive metrics from MicroProfile Metrics including JVM statistics,
        CPU usage, thread pool status, servlet performance, and session management.
      availability: []
      scopes:
        - name: global
          description: These metrics refer to the entire WebSphere Liberty server instance.
          labels: []
          metrics:
            - name: websphere_mp.jvm_memory_heap_usage
              description: JVM Heap Memory Usage
              unit: bytes
              chart_type: stacked
              dimensions:
                - name: used
                - name: free
            - name: websphere_mp.jvm_memory_heap_committed
              description: JVM Heap Memory Committed
              unit: bytes
              chart_type: line
              dimensions:
                - name: committed
            - name: websphere_mp.jvm_memory_heap_max
              description: JVM Heap Memory Maximum
              unit: bytes
              chart_type: line
              dimensions:
                - name: limit
            - name: websphere_mp.jvm_heap_utilization
              description: JVM Heap Utilization
              unit: percentage
              chart_type: line
              dimensions:
                - name: utilization
            - name: websphere_mp.jvm_gc_collections
              description: JVM Garbage Collection
              unit: collections/s
              chart_type: line
              dimensions:
                - name: rate
            - name: websphere_mp.jvm_gc_time
              description: JVM GC Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: total
                - name: per_cycle
            - name: websphere_mp.jvm_threads_current
              description: JVM Current Threads
              unit: threads
              chart_type: stacked
              dimensions:
                - name: daemon
                - name: other
            - name: websphere_mp.jvm_threads_peak
              description: JVM Peak Threads
              unit: threads
              chart_type: line
              dimensions:
                - name: peak
            - name: websphere_mp.jvm_classes_loaded
              description: JVM Classes Loaded
              unit: classes
              chart_type: line
              dimensions:
                - name: loaded
            - name: websphere_mp.jvm_classes_unloaded_rate
              description: JVM Classes Unloaded Rate
              unit: classes/s
              chart_type: line
              dimensions:
                - name: unloaded
            - name: websphere_mp.cpu_usage
              description: JVM CPU Usage
              unit: percentage
              chart_type: line
              dimensions:
                - name: process
                - name: utilization
            - name: websphere_mp.cpu_time
              description: JVM CPU Time
              unit: seconds
              chart_type: line
              dimensions:
                - name: total
            - name: websphere_mp.cpu_processors
              description: Available Processors
              unit: processors
              chart_type: line
              dimensions:
                - name: available
            - name: websphere_mp.system_load
              description: System Load Average
              unit: load
              chart_type: line
              dimensions:
                - name: 1min
            - name: websphere_mp.threadpool_usage
              description: Thread Pool Usage
              unit: threads
              chart_type: stacked
              dimensions:
                - name: active
                - name: idle
            - name: websphere_mp.threadpool_size
              description: Thread Pool Size
              unit: threads
              chart_type: line
              dimensions:
                - name: size
            - name: websphere_mp.servlet_requests
              description: Servlet Requests
              unit: requests/s
              chart_type: line
              dimensions:
                - name: requests
            - name: websphere_mp.servlet_response_time
              description: Servlet Response Time
              unit: milliseconds
              chart_type: line
              dimensions:
                - name: avg_response_time
            - name: websphere_mp.session_active
              description: Active Sessions
              unit: sessions
              chart_type: line
              dimensions:
                - name: active
                - name: live
            - name: websphere_mp.session_lifecycle
              description: Session Lifecycle
              unit: sessions/s
              chart_type: line
              dimensions:
                - name: created
                - name: invalidated
                - name: timed_out
