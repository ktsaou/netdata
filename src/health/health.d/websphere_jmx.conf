# WebSphere JMX health alerts

# JVM heap usage
template: websphere_jmx_jvm_heap_usage
      on: websphere_jmx.jvm_heap_usage
   class: Utilization
    type: Application Server
component: WebSphere
    calc: $usage
   units: %
   every: 10s
    warn: $this > 80
    crit: $this > 90
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere JVM heap usage
    info: JVM heap memory usage is ${value}%
      to: webmaster

# Thread pool utilization
template: websphere_jmx_threadpool_usage
      on: websphere_jmx.threadpool_size
   class: Utilization
    type: Application Server
component: WebSphere
    calc: $size * 100 / $max
   units: %
   every: 10s
    warn: $this > 80
    crit: $this > 90
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere thread pool ${label:thread_pool} usage
    info: Thread pool ${label:thread_pool} is ${value}% utilized
      to: webmaster

# JDBC pool utilization
template: websphere_jmx_jdbc_pool_usage
      on: websphere_jmx.jdbc_pool_active
   class: Utilization
    type: Database
component: WebSphere
    calc: $active * 100 / ($active + $free)
   units: %
   every: 10s
    warn: $this > 80
    crit: $this > 90
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere JDBC pool ${label:jdbc_pool} usage
    info: JDBC connection pool ${label:jdbc_pool} is ${value}% utilized
      to: dba

# JDBC pool wait time (non-percentage, using fixed thresholds)
template: websphere_jmx_jdbc_pool_wait_time
      on: websphere_jmx.jdbc_pool_wait_time
   class: Latency
    type: Database
component: WebSphere
    calc: $wait_time
   units: ms
   every: 10s
    warn: $this > 1000
    crit: $this > 5000
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere JDBC pool ${label:jdbc_pool} wait time
    info: JDBC connection pool ${label:jdbc_pool} average wait time is ${value}ms
      to: dba

# JMS queue depth (non-percentage, using fixed thresholds)
template: websphere_jmx_jms_queue_depth
      on: websphere_jmx.jms_messages
   class: Workload
    type: Messaging
component: WebSphere
   hosts: *
    calc: $current + $pending
   units: messages
   every: 10s
    warn: $this > 1000
    crit: $this > 5000
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere JMS ${label:jms_type} ${label:jms_destination} queue depth
    info: JMS ${label:jms_type} ${label:jms_destination} has ${value} messages queued
      to: webmaster

# Application error rate (non-percentage, using fixed thresholds)
template: websphere_jmx_app_errors
      on: websphere_jmx.app_errors
   class: Errors
    type: Web Server
component: WebSphere
   hosts: *
    calc: $errors
   units: errors
   every: 10s
    warn: $this > 10
    crit: $this > 50
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere application ${label:application} errors
    info: Application ${label:application} has ${value} errors
      to: webmaster

# Application response time (non-percentage, using fixed thresholds)
template: websphere_jmx_app_response_time
      on: websphere_jmx.app_response_time
   class: Latency
    type: Web Server
component: WebSphere
   hosts: *
    calc: $avg
   units: ms
   every: 10s
    warn: $this > 1000
    crit: $this > 5000
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere application ${label:application} response time
    info: Application ${label:application} average response time is ${value}ms
      to: webmaster

# Cluster state (deployment managers only)
template: websphere_jmx_cluster_degraded
      on: websphere_jmx.cluster_state
   class: Availability
    type: Application Server
component: WebSphere
   hosts: server_type:dmgr
    calc: $state
   units: state
   every: 10s
    warn: $this < 2
    crit: $this < 1
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere cluster ${label:cluster} state
    info: Cluster ${label:cluster} is in ${value} state (0=stopped, 1=partial, 2=running)
      to: sysadmin

# Cluster members availability
template: websphere_jmx_cluster_members_missing
      on: websphere_jmx.cluster_members
   class: Availability
    type: Application Server
component: WebSphere
   hosts: server_type:dmgr
    calc: ($target - $running) * 100 / $target
   units: %
   every: 10s
    warn: $this > 0
    crit: $this > 50
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere cluster ${label:cluster} members missing
    info: ${value}% of cluster ${label:cluster} members are not running
      to: sysadmin

# Connection health
template: websphere_jmx_connection_health
      on: websphere_jmx.connection_health
   class: Availability
    type: Application Server
component: WebSphere
   hosts: *
    calc: $health
   units: status
   every: 10s
    warn: $this < 1
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere JMX connection health
    info: WebSphere JMX connection health is ${value} (0=down, 1=up)
      to: webmaster

# Circuit breaker state
template: websphere_jmx_circuit_breaker_open
      on: websphere_jmx.connection_health
   class: Availability
    type: Application Server
component: WebSphere
   hosts: *
    calc: $circuit_breaker
   units: state
   every: 10s
    warn: $this > 0
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere JMX circuit breaker state
    info: Circuit breaker is in state ${value} (0=closed, 1=half-open, 2=open)
      to: silent

# Connection staleness
template: websphere_jmx_connection_stale
      on: websphere_jmx.connection_staleness
   class: Latency
    type: Application Server
component: WebSphere
   hosts: *
    calc: $age
   units: seconds
   every: 10s
    warn: $this > 60
    crit: $this > 300
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere JMX using stale data
    info: Using cached metrics from ${value} seconds ago
      to: webmaster

# Replication failures
template: websphere_jmx_replication_failures
      on: websphere_jmx.replication_health
   class: Errors
    type: Application Server
component: WebSphere
   hosts: server_type:dmgr
    calc: $sync_failures
   units: failures
   every: 10s
    warn: $this > 10
    crit: $this > 100
   delay: down 5m multiplier 1.5 max 1h
 summary: WebSphere replication sync failures
    info: Cluster ${label:cluster} has ${value} replication sync failures
      to: sysadmin