# IBM MQ PCF collector alerts

# Queue depth alerts
template: mq_pcf_queue_depth_usage
      on: mq_pcf.queue_local_depth
      os: linux
   class: Utilization
    type: Messaging
component: IBM MQ
  lookup: average -5m unaligned of depth
    calc: $this * 100 / ($max_depth > 0 ? $max_depth : 1)
   units: %
   every: 10s
    warn: $this > 80
    crit: $this > 90
   delay: down 5m multiplier 1.5 max 1h
 summary: IBM MQ queue depth high
    info: Queue ${label:queue} depth is at ${value}% of maximum capacity (${label:queue_manager} on ${label:host})
      to: sysadmin

template: mq_pcf_queue_depth_critical
      on: mq_pcf.queue_local_depth
      os: linux
   class: Utilization
    type: Messaging
component: IBM MQ
  lookup: average -1m unaligned of depth
    calc: $this >= $max_depth
   units: boolean
   every: 10s
    warn: $this == 1
   delay: down 5m multiplier 1.5 max 1h
 summary: IBM MQ queue at maximum depth
    info: Queue ${label:queue} has reached maximum depth capacity (${label:queue_manager} on ${label:host})
      to: sysadmin

# Queue activity alerts
template: mq_pcf_queue_no_consumers
      on: mq_pcf.queue_local_activity
      os: linux
   class: Workload
    type: Messaging
component: IBM MQ
  lookup: average -5m unaligned of open_input_count
   units: connections
   every: 30s
    warn: $this == 0
   delay: down 10m multiplier 1.5 max 1h
 summary: IBM MQ queue has no consumers
    info: Queue ${label:queue} has no active consumers for 5 minutes (${label:queue_manager} on ${label:host})
      to: silent

template: mq_pcf_queue_messages_accumulating
      on: mq_pcf.queue_local_messages
      os: linux
   class: Workload
    type: Messaging
component: IBM MQ
  lookup: sum -5m unaligned of enqueued
    calc: ($this - ($dequeued > 0 ? $dequeued : 0)) > 0 ? $this - $dequeued : 0
   units: messages
   every: 30s
    warn: $this > 1000
    crit: $this > 5000
   delay: down 10m multiplier 1.5 max 1h
 summary: IBM MQ queue messages accumulating
    info: Queue ${label:queue} has ${value} messages accumulating over last 5 minutes (${label:queue_manager} on ${label:host})
      to: sysadmin

# Channel status alerts
template: mq_pcf_channel_not_running
      on: mq_pcf.channel_status
      os: linux
   class: Availability
    type: Messaging
component: IBM MQ
  lookup: average -1m unaligned of running
   units: boolean
   every: 10s
    crit: $this == 0
   delay: down 5m multiplier 1.5 max 1h
 summary: IBM MQ channel not running
    info: Channel ${label:channel} is not in running state (${label:queue_manager} on ${label:host})
      to: sysadmin

template: mq_pcf_channel_retrying
      on: mq_pcf.channel_status
      os: linux
   class: Errors
    type: Messaging
component: IBM MQ
  lookup: average -5m unaligned of retrying
   units: boolean
   every: 30s
    warn: $this > 0
   delay: down 10m multiplier 1.5 max 1h
 summary: IBM MQ channel in retry state
    info: Channel ${label:channel} has been retrying for 5 minutes (${label:queue_manager} on ${label:host})
      to: sysadmin

# Queue Manager alerts
template: mq_pcf_queue_manager_not_running
      on: mq_pcf.qmgr_status
      os: linux
   class: Availability
    type: Messaging
component: IBM MQ
  lookup: average -1m unaligned of status
   units: status
   every: 10s
    crit: $this < 2
   delay: down 5m multiplier 1.5 max 1h
 summary: IBM MQ Queue Manager not running
    info: Queue Manager ${label:queue_manager} is not in running state (status: ${value})
      to: sysadmin

# Monitoring status alerts
template: mq_pcf_queues_monitoring_failures
      on: mq_pcf.queues_overview
      os: linux
   class: Errors
    type: Messaging
component: IBM MQ
  lookup: sum -5m unaligned of failed,unauthorized
   units: queues
   every: 30s
    warn: $this > 0
   delay: down 10m multiplier 1.5 max 1h
 summary: IBM MQ queue monitoring failures
    info: ${value} queues failed monitoring or unauthorized (${label:queue_manager} on ${label:host})
      to: silent

template: mq_pcf_channels_monitoring_failures
      on: mq_pcf.channels_overview
      os: linux
   class: Errors
    type: Messaging
component: IBM MQ
  lookup: sum -5m unaligned of failed,unauthorized
   units: channels
   every: 30s
    warn: $this > 0
   delay: down 10m multiplier 1.5 max 1h
 summary: IBM MQ channel monitoring failures
    info: ${value} channels failed monitoring or unauthorized (${label:queue_manager} on ${label:host})
      to: silent

# Performance alerts
template: mq_pcf_channel_low_batch_efficiency
      on: mq_pcf.channel_batch_size
      os: linux
   class: Workload
    type: Messaging
component: IBM MQ
  lookup: average -5m unaligned of batch_size
   units: messages
   every: 60s
    warn: $this < 10
   delay: down 15m multiplier 1.5 max 1h
 summary: IBM MQ channel low batch efficiency
    info: Channel ${label:channel} averaging only ${value} messages per batch (${label:queue_manager} on ${label:host})
      to: silent

# Queue inhibit alerts
template: mq_pcf_queue_get_inhibited
      on: mq_pcf.queue_local_inhibit
      os: linux
   class: Availability
    type: Messaging
component: IBM MQ
  lookup: average -1m unaligned of inhibit_get
   units: boolean
   every: 30s
    warn: $this == 1
   delay: down 5m multiplier 1.5 max 1h
 summary: IBM MQ queue GET inhibited
    info: Queue ${label:queue} has GET operations inhibited (${label:queue_manager} on ${label:host})
      to: sysadmin

template: mq_pcf_queue_put_inhibited
      on: mq_pcf.queue_local_inhibit
      os: linux
   class: Availability
    type: Messaging
component: IBM MQ
  lookup: average -1m unaligned of inhibit_put
   units: boolean
   every: 30s
    warn: $this == 1
   delay: down 5m multiplier 1.5 max 1h
 summary: IBM MQ queue PUT inhibited
    info: Queue ${label:queue} has PUT operations inhibited (${label:queue_manager} on ${label:host})
      to: sysadmin